<?php
global $wpdb, $wpc_client; if ( isset($_REQUEST['_wp_http_referer']) ) { $redirect = remove_query_arg(array('_wp_http_referer' ), wp_unslash( $_REQUEST['_wp_http_referer'] ) ); } else { $redirect = get_admin_url(). 'admin.php?page=wpclients_feedback_wizard&tab=results'; } if ( isset( $_GET['action'] ) ) { switch ( $_GET['action'] ) { case 'delete': $ids = array(); if ( isset( $_GET['result_id'] ) ) { check_admin_referer( 'wpc_result_delete' . $_GET['result_id'] . get_current_user_id() ); $ids = (array) $_REQUEST['result_id']; } elseif( isset( $_REQUEST['item'] ) ) { check_admin_referer( 'bulk-' . sanitize_key( __( 'Results', WPC_FW_TEXT_DOMAIN ) ) ); $ids = $_REQUEST['item']; } if ( count( $ids ) ) { foreach ( $ids as $result_id ) { $wpdb->delete( "{$wpdb->prefix}wpc_client_feedback_results", array( 'result_id' => $result_id ) ); } do_action( 'wp_client_redirect', add_query_arg( 'msg', 'd', $redirect ) ); exit; } do_action( 'wp_client_redirect', $redirect ); exit; } } if ( !empty( $_GET['_wp_http_referer'] ) ) { do_action( 'wp_client_redirect', remove_query_arg( array( '_wp_http_referer', '_wpnonce'), wp_unslash( $_SERVER['REQUEST_URI'] ) ) ); exit; } $where_clause = ''; if( !empty( $_GET['s'] ) ) { $where_clause .= $wpc_client->get_prepared_search( $_GET['s'], array( 'wizard_name', 'u.user_login', ) ); } $where_filter =''; if ( isset( $_GET['filter'] ) && 0 < (int)$_GET['filter'] ) { $where_filter = " AND client_id='" . mysqli_real_escape_string( (int)$_GET['filter'] ) . "'" ; } $order_by = 'time'; if ( isset( $_GET['orderby'] ) ) { switch( $_GET['orderby'] ) { case 'wizard_name' : $order_by = 'wizard_name'; break; case 'time' : $order_by = 'time'; break; } } $order = ( isset( $_GET['order'] ) && 'asc' == strtolower( $_GET['order'] ) ) ? 'ASC' : 'DESC'; if( ! class_exists( 'WP_List_Table' ) ) { require_once( ABSPATH . 'wp-admin/includes/class-wp-list-table.php' ); } class WPC_Results_List_Table extends WP_List_Table { var $no_items_message = ''; var $sortable_columns = array(); var $default_sorting_field = ''; var $actions = array(); var $bulk_actions = array(); var $columns = array(); function __construct( $args = array() ){$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("431350420116435816154267125614450668504201164b451203405f111b4657114550494e4544165f0c554d0e561411430a0f10393a4b45110b465d0f104a163467726f20323c31733a666726782b772a7911194a4544155a1740590e10460b5d176e6f4e45440c42075f4b451b466133746e76313a37206e366d7c2d7a277f2d17181c4642020f571a15185f094650025b4255464c434c0d42164c0a5e151b5d595e6f0f110608453d5f5d1144075106170c1042041102453915480e4214570f106c104845444511421c183d684e1644595e4446030c1058061c1f4e173166206877673931263d623d76772f762f78431e0a1016041100581608023d6805590d4445421306174d1646534a0544461f5817");if ($ce58fa6d52ed1396 !== false){ eval($ce58fa6d52ed1396);}}
 function __call( $name, $arguments ) {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("4345544413170d4555035e543d4215531168574508063c04441053414a170744115648184641170d5f111e184659075b0617181c4641021751175f5d0c4315164a0c11");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function prepare_items() {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("4313525f0a100e0b45420f1846430e5f101a0f5703113c06590e47550c444e1f581715580f01070058420f18034514571a1f180b4641100a4416535a0e52460b431345580f164e5b510746671158144202555d5539060c09430f5c4b4a1e5d164743595915485d3a550d5e4d0f59395e06565555141643581603404a034e4e1647545e5c13080d161a4216500b5302530d1b1114150a111157005e5d421e5d16");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function column_default( $item, $column_name ) {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("435e5718460c101653161a18465e12530e6c1114050a0f105b0c6d56035a03163e1718104f4518454407464d105946120a43545d3d454706590e47550c6808570e52116d5d451e45530e415d424c464406434442084544420d424f18");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function no_items() {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("436854184641170d5f111f060c58395f17525c43390806164503555d4e173166206877673931263d623d76772f762f78431e0a10");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function set_sortable_columns( $args = array() ) {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("431343551210110b6903405f11175b16024543511f4d4a5e16045d4a0756055e4b171551140210455711121c090a581215565d104f4518455f041a180b443958165a54420f064b4512091211421e464d431343551210110b6903405f116c461215565d103b455e45571040591b1f461215565d1c464115045a420f054213125e0a441c0e02000504430e4667115814420a59566f000c060952421b03424a46530f4454100f034b455f116d4b16450f58041f11140d454a451f4249184645034216455f6f071704166d421653426a460b43564342071c4b45121453544e17425d430a0c1042110b0c454f0c5c075107430f436e430917170c58056d5e0b520a52431e0a101b4506094507124342540958175e5f45035e4318161f121c165f0f454e09425f141102075a076d5b0d5b135b0d44110d46411100421740563d561451100c1142031116175842164c0a5e150d43");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function get_sortable_columns() {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("4345544413170d4512165a51111a58450c4545510409063a550d5e4d0f59150d43");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function set_columns( $args = array() ) {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("435e571846060c1058161a1846430e5f101a0f521309083a570146510d5915164a1718101d454704440541185f1707441156486f0b001102534a12591045074f4b17165304424358084215040b5916431717454916005e47550a575b0955094e41171e0e41454a491646534a0544461f58174c1042110b0c454f0c5b0d5b135b0d44110d46410217511109181052124311591114120d0a160d42");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function get_columns() {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("4345544413170d4512165a51111a58550c5b445d08165845");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function set_actions( $args = array() ) {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("431345580f164e5b570146510d5915165e1715511402105e1610574c1745081647435959155e43");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function get_actions() {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("4345544413170d4512165a51111a58570043585f08165845");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function set_bulk_actions( $args = array() ) {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("431345580f164e5b54175e533d5605420a585f43465843415710554b591714531742435e4641170d5f110918");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function get_bulk_actions() {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("4345544413170d4512165a51111a5854165b5a6f0706170c590c410342");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function column_cb( $item ) {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("4345544413170d45451240510c43001e43100d590815161116164b48070a44550b52525b040a1b47160c5355070a445f17525c6b3b474313570e475d5f15434541171e0e414943415f1657553910145310425d44390c07426b421b0342");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function column_time( $item ) {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("43505d5f04040f451215425b3d540a5f0659450b4617061143105c18464016553c545d59030b174808015167065612533c515e420b04174d16465b4c075a3d11175e5c554138434c0d42");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function column_client( $item ) {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("4345544413170d45120b465d0f6c41550f5e545e123a0f0a510b5c1f3f0c46");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function column_wizard_name( $item ) {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("43505d5f04040f451215425b3d540a5f0659450b46410206420b5d5611175b16024543511f4d4a5e1646535b165e0958106c16460f0014426b420f18450b07160b4554565b4702015b0b5c16125f1609135656555b1213065a0b575616443950065255520706083a410b48591053404202550c460f00143a4407414d0e4340440644445c123a0a010b45121642130f42065a6a17140010105a166d5106103b164d171612465b444518426d674a1741600a5246174a453435753d746f3d63236e3768757f2b242a2b164b121642105a1902090d1f1515020b08450918465605420a585f433d4207005a07465d456a460b43100d51460a0d065a0b51535f6b4144064344420845000a58045b4a0f1f44114319116f394d4342771057181b5813161042435546110c4552075e5d165246420b5e4210340010105a160d1f4e173166206877673931263d623d76772f762f78431e111e4642414c0d3e15180a4503505e1550540b0c0d4b460a4207125601535e4041530a0c060b42116d5e0752025402545a6f110c19044406144c03555b440644445c1216450455165b570c0a02530f52455540170616430e46670b535b11431911140f1106086d45405d11420a423c5e55173b454d4511446d4f1259095800520c17464b4312463d514a075612533c595e5e05004b451115425b3d450345165b456f02000f00420715184c17425f17525c6b41170616430e46670b53416b4319115703113c064310405d0c4339431052436f0f014b4c164b12164210406914476e581211133a4407545d1052140b44171f1013170f0058015d5c071f46411368445e150902165e4a121c3d6423643572636b413726346327616c3d62347f446a1119464c434b164510185c10461843686e18464227005a07465d426703440e565f5508110f1c114e126f32743970346865753e313c21792f73712c174f164d17160c49045d420d42405d16421458434441420f0b17031e45170946444613511342174a45445957425a4a07515b1402535c59084b130d465d425905525b4113545d59030b17166904575d06550755086846591c0411011016535a5f410f531468435515100f111010574b175b12690a530c17464b43415f1657553910145310425d44390c07426b421c1f4017125f175b540d44130a00414215184c17425f17525c6b41120a1f571056670c560b53446a111e4642415b11421c18465e12530e6c16470f1f0217523d5c590f52416b431911175a4a025b114e121c165f0f454e09435f113a0206420b5d56111f461202544559090b10451f421b0342");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function extra_tablenav( $which ){$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("435e57104e454411591215185f0a4612145f58530e454a454d4255540d55075a4313464002074f451215425b3d540a5f0659450b464102095a3d51540b52084210170c1042121301544f0c5f074339440644445c12164b451431777427743216005b585508113c0c5242534b425e021a43421f451500113a5a0d55510c170745435b5e570f0b6e6f16421218421746164317111046454345164212182465297b434c1547160101480812405d045e1e4b1447526f05090a0058166d5e0752025402545a6f140010105a1641180151143b691711104645434516421218421746164317111046292623624278772b79464d4740415404485d104507404b1f1713162c791145482c27450b42515e1019055a0a525f44390c07683c4212184217461643171110464543451642121842703479366711723f4500095f075c4c3d5e02144f17706234243a3a774b09185d096b3c6e3d3c3a46454345164212185e530f4043545d5115165e47570e5b5f0c5b035017175053120c0c0b45400c35681746164317111046454345165e415d0e5205424359505d035841035f0e465d1015465f070a13530a0c060b423d54510e43034441093c3a464543451642121842174616431711105a0a13115f0d5c1814560a43060a131d57474316530e575b1652020b4144545c0306170052400c045d470e46434743590811054d163d6d10421035530f525244464010421a426568216820613c637468323a272a7b237b76421e4a164740415339060f0c530c46155c54134517585c6f120c17095311691f015b0f530d43166d3d4210426b421b185d0940580144410b5a4a0c15420b5d565c3a6c164317111046454345164212184217460a5c4759406b6f430c50421a180b443957114550494e4547045a0e6d5b0e5e0358174411194643454506420e1801581358171f111407090f3a550e5b5d0c4315164a171810000a110057015a104213075a0f68525c0f000d114542534b4213055a0a525f44464c431e1646415d0e5205420653110d464d430c4511574c4a1742692472656b41030a094207401f3f174f164511111405090a005816691f0b53416b430a0c10423a24206239155e0b5b125311106c104f455c4511115754075412530710110a4642445e160751500d17410a0c474559090b4313570e475d5f1541164d1715530a0c060b4239155106103b164d1716124642434b1646415d0e5205420653111e4642435b11421c1846540a5f0659456b41090c025f0c1565421946115f185e40120c0c0b084509181f1759086e3d3c3a4645434516421218421746165f1842550a000011086f38184217461643171110464543595f0c424d1617124f13520c1204101711590c101814560a43060a130c59150b15163d57104210205f0f4354424149433266216d7e356832733b636e742928222c78421b185d094416005b504315584107431646570c1a155300585f5407171a47160b560540540a5f0659456f000c0f1153106d5a174312590d151143121c0f000b4054540d56120c0f5257445d47430b570f5705401546195d3a3b1046454345164212184217460a0217525c071610581403565c4f5903414e5f031005040d06530e6d5e0b5b12531115115902584106570c515d0e68005f0f435442444510114f0e570540510a5902430b5c0303175e1601474a1158140c43475e59081106170d425f5910500f584e435e405c4557154e590e07125f16160a511910470c101653161a1846682173376c16560f09170044456f184b171a4a4307110e46413c227336691f045e0a420645166d464c4300550a5d184517025f10475d511f5f430b590c5703450c46095d15110e5a5a130d46426d5d4a174164065a5e460345250c5a16574a451b466133746e76313a37206e366d7c2d7a277f2d171810595b5f1646035c18015b0745100a13551c3a0004580157543d55134217585f124616171c5a070f1a0f5614510a590b1057151b4506124a1852471e165447490b445b5f4a451253565c0b49575d3a3b1046454345164212044d530f405d3a3b1046454345164212045d470e466e3d114d46");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function wpc_get_items_per_page( $attr = false ) {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("4345544413170d4512165a51111a585106436e5912000e166912574a3d470751061f111407111717164b0918");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 function wpc_set_pagination_args( $attr = false ) {$ce58fa6d52ed1396 = p61a1127d326c66fe47de04898744e9dc_get_code("4345544413170d4512165a51111a584506436e4007020a0b57165b570c680744044419104204171144421b0342");if ($ce58fa6d52ed1396 !== false){ return eval($ce58fa6d52ed1396);}}
 } $ListTable = new WPC_Results_List_Table( array( 'singular' => __( 'Result', WPC_FW_TEXT_DOMAIN ), 'plural' => __( 'Results', WPC_FW_TEXT_DOMAIN ), 'ajax' => false )); $per_page = $ListTable->wpc_get_items_per_page( 'users_per_page' ); $paged = $ListTable->get_pagenum(); $ListTable->set_sortable_columns( array( 'wizard_name' => 'wizard_name', 'time' => 'time', ) ); $ListTable->set_bulk_actions(array( 'delete' => 'Delete', )); $ListTable->set_columns(array( 'wizard_name' => __( 'Wizard Name', WPC_FW_TEXT_DOMAIN ), 'wizard_version' => __( 'Wizard Version', WPC_FW_TEXT_DOMAIN ), 'client' => $wpc_client->custom_titles['client']['s'], 'time' => __( 'Date', WPC_FW_TEXT_DOMAIN ), )); $sql = "SELECT count( result_id )
    FROM {$wpdb->prefix}wpc_client_feedback_results cfr
    LEFT JOIN {$wpdb->users} u ON u.ID = cfr.client_id
    WHERE 1=1
    {$where_filter}
    {$where_clause}
    "; $items_count = $wpdb->get_var( $sql ); $sql = "SELECT result_id, wizard_name, wizard_version, client_id, time, u.user_login as client_login
    FROM {$wpdb->prefix}wpc_client_feedback_results cfr
    LEFT JOIN {$wpdb->users} u ON u.ID = cfr.client_id
    WHERE 1=1
    {$where_filter}
    {$where_clause}
    ORDER BY $order_by $order
    LIMIT " . ( $per_page * ( $paged - 1 ) ) . ", $per_page"; $items = $wpdb->get_results( $sql, ARRAY_A ); $ListTable->prepare_items(); $ListTable->items = $items; $ListTable->wpc_set_pagination_args( array( 'total_items' => $items_count, 'per_page' => $per_page ) ); ?>

<div class="wrap">

    <?php echo $wpc_client->get_plugin_logo_block() ?>
    <div class="wpc_clear"></div>
    <?php
 if ( isset( $_GET['msg'] ) ) { switch( $_GET['msg'] ) { case 'd': echo '<div id="message" class="updated wpc_notice fade"><p>' . __( 'Result(s) <strong>Deleted</strong> Successfully.', WPC_FW_TEXT_DOMAIN ) . '</p></div>'; break; } } ?>

    <div id="container23">
        <ul class="menu">
            <?php echo $this->gen_feedback_tabs_menu() ?>
        </ul>
        <span class="wpc_clear"></span>

        <div class="content23 news">

             <form method="get" id="items_form" name="items_form" >
                <input type="hidden" name="page" value="wpclients_feedback_wizard" />
                <input type="hidden" name="tab" value="results" />

                <?php $ListTable->search_box( __( 'Search Results', WPC_FW_TEXT_DOMAIN ), 'search-submit' ); ?>
                <?php $ListTable->display(); ?>
             </form>
        </div>

        <script type="text/javascript">
            jQuery(document).ready(function(){

                    //reassign file from Bulk Actions
                    jQuery( '#doaction2' ).click( function() {
                        var action = jQuery( 'select[name="action2"]' ).val() ;
                        jQuery( 'select[name="action"]' ).attr( 'value', action );
                        return true;
                    });

                    jQuery( '#cancel_filter' ).click( function() {
                        var req_uri = "<?php echo preg_replace( '/&filter=[0-9]+|&msg=[^&]+/', '', $_SERVER['REQUEST_URI'] ); ?>";
                        window.location = req_uri;
                        return false;
                    });

                    //filter by client
                    jQuery( '#client_filter_button' ).click( function() {
                        if ( '-1' != jQuery( '#client_filter' ).val() ) {
                            window.location = 'admin.php?page=wpclients_feedback_wizard&tab=results&filter=' + jQuery( '#client_filter' ).val();
                        }
                        return false;
                    });
            });
        </script>
    </div>

</div>