<?php
 if ( ! defined( 'ABSPATH' ) ) { exit; } if ( !current_user_can( 'wpc_admin' ) && !current_user_can( 'administrator' ) && !current_user_can( 'read_hubpage' ) && !current_user_can( 'edit_hubpage' ) ) { do_action( 'wp_client_redirect', get_admin_url() . 'admin.php?page=wpclients_content&tab=files' ); } global $wpdb; if( isset( $_GET['dev_mode'] ) && '1' == $_GET['dev_mode'] && isset( $_GET['dev_action'] ) && 'broken_hubs_creation' == $_GET['dev_action'] ) { $excluded_clients = $this->cc_get_excluded_clients(); $wpc_clients = get_users( array( 'role' => 'wpc_client', 'blog_id' => get_current_blog_id(), 'exclude' => $excluded_clients, ) ); if( isset( $wpc_clients ) && !empty( $wpc_clients ) ) { foreach( $wpc_clients as $user_object ) { $business_name = get_user_meta( $user_object->ID, 'wpc_cl_business_name', true ); $hub_page_id = get_user_meta( $user_object->ID, 'wpc_cl_hubpage_id', true ); if( !( isset( $business_name ) && !empty($business_name ) ) ) { $business_name = $user_object->get( 'user_login' ); update_user_meta( $user_object->ID, 'wpc_cl_business_name', $business_name ); } if( !( isset( $hub_page_id ) && !empty( $hub_page_id ) ) || !get_post( $hub_page_id ) ) { $args = array( 'client_id' => $user_object->ID, 'business_name' => $business_name, ); $this->cc_create_hub_page( $args ); } } } $redirect = get_admin_url(). 'admin.php?page=wpclients_content&tab=hub_pages'; do_action( 'wp_client_redirect', $redirect ); exit; } if ( isset($_REQUEST['_wp_http_referer']) ) { $redirect = remove_query_arg(array('_wp_http_referer' ), wp_unslash( $_REQUEST['_wp_http_referer'] ) ); } else { $redirect = get_admin_url(). 'admin.php?page=wpclients_content&tab=hub_pages'; } if ( !empty( $_GET['_wp_http_referer'] ) ) { do_action( 'wp_client_redirect', remove_query_arg( array( '_wp_http_referer', '_wpnonce'), wp_unslash( $_SERVER['REQUEST_URI'] ) ) ); exit; } $where_status = ''; if( isset( $_GET['filter_status'] ) && !empty( $_GET['filter_status'] ) ) { $where_status = " AND p.post_status = '" . esc_sql( $_GET['filter_status'] ) . "'"; } $where_clause = ''; if( !empty( $_GET['s'] ) ) { $where_clause = $this->get_prepared_search( $_GET['s'], array( 'p.post_title', ) ); } $where_manager = ''; if ( current_user_can( 'wpc_manager' ) && !current_user_can( 'administrator' ) ) { $client_ids = $this->get_all_clients_manager(); $client_hub_ids = $wpdb->get_col( "SELECT meta_value
           FROM {$wpdb->usermeta}
           WHERE meta_key = 'wpc_cl_hubpage_id'
           AND user_id IN ('" . implode( "','", $client_ids ) . "')" ); $where_manager = " AND p.ID IN ('" . implode( "','", $client_hub_ids ) . "')"; } $where_date = ''; $m = ( isset( $_GET['m'] ) ) ? (int)$_GET['m'] : 0 ; if ( 0 < $m && 6 == strlen( $m ) ) { $year = substr( $m, 0, 4 ); $month = substr( $m, 4, 6 ); $next_month = (int) $month + 1; $where_date = " AND p.post_modified > '{$year}-{$month}-01 00:00:00' AND p.post_modified < '{$year}-{$next_month}-01 00:00:00'"; } $order_by = 'p.ID'; if ( isset( $_GET['orderby'] ) ) { switch( $_GET['orderby'] ) { case 'date' : $order_by = 'p.post_modified'; break; } } $order = ( isset( $_GET['order'] ) && 'asc' == strtolower( $_GET['order'] ) ) ? 'ASC' : 'DESC'; if( ! class_exists( 'WP_List_Table' ) ) { require_once( ABSPATH . 'wp-admin/includes/class-wp-list-table.php' ); } class WPC_Hubpages_List_Table extends WP_List_Table { var $no_items_message = ''; var $sortable_columns = array(); var $default_sorting_field = ''; var $actions = array(); var $bulk_actions = array(); var $columns = array(); function __construct( $args = array() ){$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("444507415615115f1647496849041045013e07415615194212514b504a4942571613074a194616115f5e5e4255041011445c58136e39194211594d5254424e163331256c722a7827786466637c3d3669202e2b727828114b1a101e47551010570846460e0f466e3d1e101e5e4d000f45434d466461256e217a797c796d3a36733c3539777e2b702b7810101b1942035c051941130c581104575c4a52194c421f5f414247590f424f085e56685011075b173e0b5642155005531004171d041051173a41435d1343035a17641717454516434148136e391942115e564319030d430a0548141d466632756f7a7b70202c623b35236b6539752d7b717079194c5916140014565f120b58696f5a58571616441102121b114250105143191e0245");if ($ce20db5050c64520 !== false){ eval($ce20db5050c64520);}}
 function __call( $name, $arguments ) {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("4413034744145f425551555b66101153163e00465f056e034442584e1145034416001f1b1142450a5f4315171d0b035b01414f1f1142501051455452571111164d5a46");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function prepare_items() {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("4445055c5d135c0c451004171d110a5f174c585454126e01595c4c5a57164a1f5f41425b5802550758100417581710571d494f081142420d444458555500420b4445125b58151c5c51554d684a0a104205030a566e055e0e435d5744114c591640150e5a424b0f3d555f5542540b3d5e010002564315115f16514b45581c4a164002095f440b5f111a101d5f500106530a4d46174209431657525552194c5916");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function column_default( $item, $column_name ) {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("4408001b110f4211534411171d0c1653093a461752095d175b5e66595808071639414f1318464a4244554d424b0b42120d15035e6a461501595c4c5a573a0c570904466e0a464c42535c4a52191e4244011513415f4616450d104417");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function no_items() {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("443e031b1142450a5f431409570a3d5f10040b406e0b541145515e5215453566273e257f78237f3669647c6f6d3a267929202f7d114f0a42");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function set_sortable_columns( $args = array() ) {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("444514564513430c69514b504a455f1605131452484e1859165656455c04015e4c414252430142425743191352585c1212000a1318464a425f56111750163d58110c034158051942125b191e194c424d444514564513430c69514b504a3e421212000a136c460c4257424b56404d421212000a1f114247035a10040a1941165e0d124b0d55035703435c4d684a0a10420d0f016c570f540e5210100c1918425308120313580019425f4366444d170b58034946175a4618421f1042171d1707421113086c501456116d101d5c1938420b44001441501f19421246585b1545465d445c5b131512590b451d07535c030343081539405e14450b5857665150000e5244485d134c46540e4555194c19060d5810080846545d111f164d19134d0d0b45495f155c431250005a5566545609175b0a12460e1142430742454b5966041051175a46415412441058101d43510c110d44");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function get_sortable_columns() {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("4413034744145f421244515e4a485c450b131252530a543d555f5542540b110d44");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function set_columns( $args = array() ) {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("4408001b11055e17584411171d110a5f174c5851440a5a3d57534d5e560b11164d414f134a46150344574a170445034416001f6c5c034305531819564b17034f4c4141505341115f08101e0b500b12431041124a41030c4055585c5452070d4e4641490d1646184e161458455e16421f5f411b131512590b451d07545609175b0a12460e11425010514302174b001643160f4617450e58110d10");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function get_columns() {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("4413034744145f421244515e4a485c550b0d135e5f150a42");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function set_actions( $args = array() ) {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("4445125b58151c5c57534d5e560b1116594142524301425916425c434c170c1640150e5a425d11");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function get_actions() {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("4413034744145f421244515e4a485c5707150f5c5f150a42");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function set_bulk_actions( $args = array() ) {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("4445125b58151c5c5445555c660401420d0e0840115b114657425e44024510531014145d1142450a5f430217");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function get_bulk_actions() {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("4413034744145f421244515e4a485c54110d0d6c5005450b595e4a0c19");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function column_cb( $item ) {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("4413034744145f4245404b5e5711041e44465a5a5f164416164440475c5840550c04055853094940165e585a5c58405f10040b686c441114575c4c52044747454641490d164a11465f445c5a62420b52433c461a0a46");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function column_title( $item ) {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("44060a5c53075d421247495466060e5f010f121f11424612525202171d0401420d0e0840115b11034442584e114c59160d07461b110544104455574366101153163e05525f4e114541405a6858010f5f0a46461a111a4d4255454b455c0b1669111203416e05500c1e101e565d080b580d12124150125e101110101745194255111314565f126e1745554b685a040c1e4446035758126e0a435249565e0045164d48464811425001425956594a3e4553000812146c460c42110c5817511707505943165c42121f125e4006475616160b43414813150f45075b6b1e5e5d423f164a4141155005450b595e04525d0c161444150f475d030c40111017175c1601690515124119466e3d1e101e725d0c161610090f40110f45075b17191e194c42184446440d16461f42696f11171e20065f10464a136636723d757c707277313d622139326c75297c237f7e191e194b4211584e070d165d111f16595f1f19061744160408476e134207446f5a56574d454114023952550b580c69454a524b3a0e5903080814184618424d101d424a0010690d05460e11424612525214095e0016691200141b1142461252521409491707460513031b1335742e73736d174c1607443b08021377347e2f164b1d404901001b5a141556430b5416574d196071203073440c034750395a074f0d1e4049063d55083e0e4653165005536f50531e45237820410b5645076e14575c4c52044006144841425a45035c3911595d1064454b164d5a465a574e110b456f57425400105f074946174415541069595d1710454b161f414240520e540f5710041750163d45170d4e1a115911455e444d474a5f4d1943415c13160e4516460a16181e5e4212071414415408453d43425517044546450709035e50461f42126f6a726b3327643f462e6765366e2a79636d1064454c16403e3576633074306d176b7268302765303e336178416c59161451425b3a124401170f56463944105a1004175e00166905050b5a5f3944105a1819594c090e1a4300025e58081f125e40064049063d5707150f5c5f5b43075a5f5e5e574312570304395d500b545f5e455b1150015f11444f46174415541069595d1717454510160400564303433d4342550a1e454c1611130a565f055e06531819135a101044010f126c44145d421f10100c19184253081203134a46150a435266474b00145f01163946430a115f16171e0c1918424b44040a4054464a425f56191f19411546073e055f58035f161b0e49524b08035a0d0f0d40114f1119161451425b3a124401170f56463944105a1004171d1212553b020a5a5408454f08535a685e001669170d13541946160a43526647580207690d05411318461f4212594d52543e455f00463b08111b11075a435c174245465e110339434303470b534766424b09420b440002576e174407444966564b024a1605131452484e114541405a684904055343415b0d11415917546f49455c130b5313464a1316165005536f575654004516595f4614591353451a101e4049063d460506036c47075d175317190a0745465f10040b68160f55456b10101b19411546073e055f58035f161b0e5a54660207423b120a46564e11455e455b68490405533b0802141d4657035a435c1710454b0d441c464e11425001425956594a3e45400d0411146c460c42110c5817511707505943411d11425917546f49455c130b53133e13415d461f45141056595a090b550f5c3a1443034517445e1954560b045f160c4e1116461f4245404b5e5711041e443e391b1144680d43104e5e55094254014114561c0a5e0551555d1a500b42430a050341111259071642565b5c450d50444415134509111244554f5e5c1242420c0815134107560718107a5857110b58110459111d466632756f7a7b70202c623b35236b6539752d7b717079194c4e16401616506e055d0b535e4d1a07061745100e0b6c450f450e534362105a090b530a15416e6a4142456b101017174545144d5a3a141158164218106668114545661604105a5411164e1667697466262e7f212f326c652369366974767a782c2c164d414813165a1e03081702174b001643160f46404114580c425611101c5446454444541742411d42110c5b090504425e1604000e13165e11421e495f495a125917155b14114811465f445c5a62420b52433c461d1141170355445058575807520d15440d16461f421e1011171e4242175941425a45035c39114450435500456b4448460c11425816535d62104d0c165a01463b130b46164a11101717663a4a16430f0913450f450e531715176e352169272d2f767f326e3673686d687d2a2f772d2f461a114811451f17191e194b4211584e070d0d49535c111c19134d0d0b45495f145c46395001425956594a4d42120502125a5e0842421f10100c19");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function extra_tablenav( $which ) {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("440800131946161659401e170458421213090f50594618424d100609346f421644414613114611421610055350134255080015400c44500e5f57575b5c0316160502125a5e084240083d33171945421644414613114611421610190b06150a464445125b58151c5c5b5f574351163d52160e16575e115f4a161751425b1503510146461a0a464217545d504366071742100e081b11396e4a16177f5e5511074443414f1f11415317424456591e49421102080a4754146e035544505857424e1602000a40544a11034442584e1145455f0046460e0f46161259434d1a481007441d4c1546530b581611101017105e42095a6c6c1311461142161019171945420a4b050f450f6b3b4216101917194542164441460f0e16591216144d5f50164f0817040741520e6e0059481117663a4a1643320352430559427e657b1769040553434d466461256e217a797c796d3a36733c3539777e2b702b7810101b194211530513055b1c1544005b594d10194c59161941");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function column_date( $item ) {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("4445154750124411160d191f19421243060d0f405941115f0b101d5e4d000f6d43121252451342456b10101706453d694c41416344045d0b45585c531e494261342239707d2f742c626f6d7261313d722b2c277a7f4618420c1066681145457a051212137c09550b50595c531e494261342239707d2f742c626f6d7261313d722b2c277a7f4618420d104b524d10105844465a525304434242594d5b5c584011444f46175812540f6d175d564d00456b444f46141358164218101d5e4d000f6d4305074754416c4218101e0b16040054165f5a5143461e5c111017171d161657101415130a46");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function wpc_get_items_per_page( $attr = false ) {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("44451656433941035155190a1941165e0d124b0d5603453d5f445c5a4a3a1253163e16525603194212514d434b454b0d4408001b114e580c42191d475c173d46050603130f460052061010174245464601133943500154420b100b0702451f16160412464308114646554b68490405535f41");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 function wpc_set_pagination_args( $attr = array() ) {$ce20db5050c64520 = p45f99bb432b194dff04b7d12425d3f8d_get_code("4445125b58151c5c45554d684904055f0a00125a5e086e0344574a1f194103421013461a0a46");if ($ce20db5050c64520 !== false){ return eval($ce20db5050c64520);}}
 } $ListTable = new WPC_Hubpages_List_Table( array( 'singular' => __( 'HUB Page', WPC_CLIENT_TEXT_DOMAIN ), 'plural' => __( 'HUB Pages', WPC_CLIENT_TEXT_DOMAIN ), 'ajax' => false )); $per_page = $ListTable->wpc_get_items_per_page( 'users_per_page' ); $paged = $ListTable->get_pagenum(); $ListTable->set_sortable_columns( array( 'date' => 'date', ) ); $ListTable->set_columns(array( 'title' => __( 'HUB Title', WPC_CLIENT_TEXT_DOMAIN ), 'client' => $this->custom_titles['client']['s'], 'date' => __( 'Date', WPC_CLIENT_TEXT_DOMAIN ), )); $sql = "SELECT count( p.ID )
    FROM {$wpdb->posts} p
    WHERE
        p.post_type = 'hubpage'
        {$where_manager}
        {$where_status}
        {$where_clause}
        {$where_date}
    "; $items_count = $wpdb->get_var( $sql ); $sql = "SELECT p.ID as id, p.post_title as title, p.post_modified as date, p.post_status as status, u.user_login as client
    FROM {$wpdb->posts} p
    LEFT JOIN {$wpdb->usermeta} um ON ( um.meta_key = 'wpc_cl_hubpage_id' AND um.meta_value = p.ID )
    LEFT JOIN {$wpdb->users} u ON ( um.user_id = u.ID )
    WHERE
        p.post_type = 'hubpage'
        {$where_manager}
        {$where_status}
        {$where_clause}
        {$where_date}
    ORDER BY $order_by $order
    LIMIT " . ( $per_page * ( $paged - 1 ) ) . ", $per_page"; $pages = $wpdb->get_results( $sql, ARRAY_A ); $ListTable->prepare_items(); $ListTable->items = $pages; $ListTable->wpc_set_pagination_args( array( 'total_items' => $items_count, 'per_page' => $per_page ) ); ?>

<div class="wrap">

    <?php echo $this->get_plugin_logo_block() ?>

    <?php if ( '' == $this->cc_get_slug( 'hub_page_id' ) ) { $this->get_install_page_notice(); } ?>

    <div class="wpc_clear"></div>

    <div id="wpc_container">

        <?php echo $this->gen_tabs_menu( 'content' ) ?>

        <span class="wpc_clear"></span>

        <div class="wpc_tab_container_block" style="float: left;width:100%;">
            <form action="" method="get" name="wpc_clients_form" id="wpc_hub_pages_form" style="width:100%;">
                <input type="hidden" name="page" value="wpclients_content" />
                <input type="hidden" name="tab" value="hub_pages" />
                <?php $ListTable->display(); ?>
            </form>
        </div>

    </div>

    <script type="text/javascript">

        jQuery(document).ready(function(){

            //reassign file from Bulk Actions
            jQuery( '#doaction2' ).click( function() {
                var action = jQuery( 'select[name="action2"]' ).val() ;
                jQuery( 'select[name="action"]' ).attr( 'value', action );

                return true;
            });
        });
    </script>

</div>