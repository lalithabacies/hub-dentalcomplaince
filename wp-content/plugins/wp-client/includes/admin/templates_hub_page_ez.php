<?php
 if ( ! defined( 'ABSPATH' ) ) { exit; } if (!$can_edit) do_action( 'wp_client_redirect', get_admin_url( 'index.php' ) ); $error = ""; if ( isset( $_REQUEST['update_hub_template'] ) ) { if ( !isset( $_REQUEST['hub_template']['name'] ) || empty( $_REQUEST['hub_template']['name'] ) ) { $error .= __('A Template Name is required.<br/>', WPC_CLIENT_TEXT_DOMAIN); } if ( empty( $error ) ) { $wpc_ez_hub_templates = $this->cc_get_settings( 'ez_hub_templates' ); if ( isset( $_REQUEST['id'] ) && '' != $_REQUEST['id'] ) { $tmp_id = $_REQUEST['id']; } else { $tmp_id = time(); } $wpc_ez_hub_settings = ( isset( $_REQUEST['hub_settings'] ) ) ? $_REQUEST['hub_settings'] : array(); do_action( 'wp_client_settings_update', $wpc_ez_hub_settings, 'ez_hub_' . $tmp_id ); $wpc_ez_hub_templates[$tmp_id]['name'] = $_REQUEST['hub_template']['name']; $wpc_ez_hub_templates[$tmp_id]['general'] = $_REQUEST['hub_template']['general']; $wpc_ez_hub_templates[$tmp_id]['type'] = 'ez'; if( (int)$_REQUEST['hub_template']['priority'] >= 0 ) { $wpc_ez_hub_templates[$tmp_id]['priority'] = (int)$_REQUEST['hub_template']['priority']; } else { $wpc_ez_hub_templates[$tmp_id]['priority'] = ''; } $content = $_REQUEST['hub_template']['content'] ; $target_path = $this->get_upload_dir( 'wpclient/_hub_templates/' ); if ( is_dir( $target_path ) ) { $content_file = fopen( $target_path . $tmp_id . '_hub_content.txt', 'w+' ); fwrite( $content_file, $content ); fclose( $content_file ); $tabs_content_file = fopen( $target_path . $tmp_id . '_hub_tabs_content.txt', 'w+' ); fwrite( $tabs_content_file, wpc_get_ez_hub_tabs_content( $tmp_id, $_REQUEST['hub_template'] ) ); fclose( $tabs_content_file ); } do_action( 'wp_client_settings_update', $wpc_ez_hub_templates, 'ez_hub_templates' ); do_action( 'wp_client_redirect', admin_url() . 'admin.php?page=wpclients_templates&tab=hubpage&action=edit_ez_template&id=' . $tmp_id . '&msg=u' ); exit; } } function wpc_get_ez_hub_tabs_content( $template_id, $hub_templates ) {$c6cd8bc28ded6d32 = p45f99bb432b194dff04b7d12425d3f8d_get_code("44060a5c53075d421247495466060e5f010f120811425917546f4a524d110b580312460e11424612556f5a5b50000c42495f05506e01541669435c434d0c0c5117494614541c6e0a43526610194b421210040b435d07450769595d17105e425f02414e13100f423d57424b56404d42120c14046c420345165f5e5e44194c424a184147505e135f161e101d5f4c073d450115125a5f0142421f101017424546531e3e0e465339550750514c5b4d455f16401616506e055d0b535e4d1a070207423b08026c420f5c125a5566435c080e5710044e1a115d11465e455b684a0016420d0f0140115b114641405a685a090b530a154b0d52056e05534466445c11165f0a06151b1141541869584c5566424218444503496e0e440069545c5158100e4244485d134c46150f535e4c17044545115f4142475004423d5f445c5a4a455f1605131452484e185916595f1711450b453b001441501f194212584c556616074210080854424618421016195456100c424c41425b44046e1153444d5e570211164d414f134a46570d44555854514d42120c14046c420345165f5e5e441904111640120347450f5f051619194c190c04164c41475a423950104451401f1941115310150f5d564618421f105a5857110b5811045d13150d541b160d19564b17034f3b0a034a424e114645554d43500b05164d5a4617420345165f5e5e170445034416001f6c47075d17534311171d16074210080854114f0a42124458554a3a0b42010c15130c465012465c40685f0c0e420113151b11414612556f5a5b50000c423b0603476e034b3d455856454d060d5201464a1315125000456f50435c08111a44450d56483d013f1a101d445c11165f0a063d036c461859164d194a190c04164c41055c4408454a16144d565b163d5f10040b40114f114b164b19585b3a11420513121b185d1146506f4d565b455f16071414415408454a16144d565b163d5f10040b406a566c421f0b19135f3a165706415b1358156e034442584e114546503b150751114f115d16145f684d0400165e4107414307484a1f0b19135f3a1657063e0d5648460c4257424b56403a09531d124e1315006e165752191e024546503b1507516e10500e4355190a1904104405183945500a4407451819135f3a165706414f0811590f6f3c3d3317194542164441460f550f4742555c58444a58404114024b475e095d00574219545500034402081e110f6b3b4216101917194542164441460f440a11015a514a4404470c5712410852474b410b5a5c4a1749100e5a490d035545440f6f3c101917194542164441461311461142160c555e19060e5717125b114616524f5e455b1a4d0a0d5a0600141e55145e12525f4e5919011059140509445f440f6f3c1019171945421644414613114611421610191719590316000012521c125e05515c5c0a1b011059140509445f4411015a514a44044706440b11025c46081c1659575e5b5c475c3b6e41461311461142161019171945421644414613115a0e125e40343d190c04164c41475a421554161e101d5f4c073d42010c165f501254116d175e525700105708463b6816035f03545c5c6850060d5817463b1318464d1e161740524a42420b5941425b44046e16535d495b581107453f4601565f0343035a17646c1e000c57060d036c58055e0c45176417104519164008055c5f3944105a1004171d1212553b020a5a5408454f084055425e0c0c69000814131f46160b5b515e524a4a0a43063e0f505e08424d5f535659664242184445006c4507533d5d55406c09384218444648435f01165916595f171145045f08043956490f42164518191350060d583b14145f114f114b164b191350060d583b14145f115b114641405a685a090b530a154b0d410a44055f5e66424b09421844460f5e5001541119584c55660c01590a12495a52095f3d111017171d033d4205033958541f6a526b1017171e4b125803465d135405590d1617055e5402425708155b1116461f421256664358073d40050d13566a566c4218101e1519161055594341131f46150b555f57684c170e164a41411313581659164d1952551607161f41425a52095f3d4342551704454641140239505d0f540c421d07475510055f0a3e13415d461f42115954565e0011190c14046c58055e0c451f5054560b3d5914150f5c5f48410c511702175c060a5944465a5a5c0111035a4404151e454c164007394750046e14575c4c5262553f164a414111111543010b121e171745465f070e086c44145d4218101e171b5b450d441c464e11590f6f3c1019171945421644414613114611421610191719454216445d594359161107555856171d033d4205033945500a44076d006417065b6f3c4441461311461142161019171945421644414613114611420a4349565745015a0512150e1305501053441b09054a1146050f583e3b46114216101917194542164441461311461142160c16560768683b6e41461311461142161019171945421644414613115a550b40105a5b5816110b4605145c41025e15581d545257104008696b46131146114216101917194542164441461311460d5d4658493a3345465f445c46030a46570d44555854514d4212100004406e0f45075b4319564a45465f10040b1318464a425f561117180c114501154e13150f45075b6b1e5a5c0b17690d15035e42416c421f10454b19440b453b001441501f194212594d52543e455b010f136c5812540f4517641710454b161f41055c5f12580c435502174445465d0118460e110743105749665c5c1c111e44450f47540b6a455b555742660c16530912416e114f0a421246585b4c00420b44001441501f6e14575c4c524a4d42120d15035e6a415c075845665e4d000f45433c461a0a460e5c3b3a1917194542164441461311461142161019171945421644415a57581011015a514a4404474008696b461311461142161019171945421644414613114611421610191719455e5744091456575b1308574658445a170b46105b105c580219521f0b1b174b000e0b4642045243395816535d660b06150a464404055b5e46150b160f071519060e5717125b115307434f5a59575c1b5b6f3c4441461311461142161019171945421644414613114611421610191719454216585e165b416b3b425f56191f19440b451704121b11425917546f4d5254150e57100415681601540c5342585b1e383911010f07515d036e0b555f57441e38421f441d1a13161f54111110040a19410a43063e12565c165d0342554a6c1e0207580113075f163b6a45535e585555003d5f070e0840163b114b164b191350060d583b14145f115b114641405a685a090b530a154b0d410a44055f5e66535017421844460f5e5001541119584c55660c01590a12495a52095f3d111017171d0e074f3f513b131f46164c465e5e1002450b5044494655580a543d534850444d164a164008055c5f3944105a101017104519164008055c5f3944105a1004171d1212553b020a5a5408454f084055425e0c0c6911130a131f46160b5b515e524a4a0a43063e0f505e08424d5f5356596642421844450d56483d013f161e191017150c51435a4656520e5e42110c505a5e45035a105c441411481146405155425c3e526b444f461413464210550d1b10194b42120d02095d6e13430e161e191019475c115f411b13540a4207164b191350060d583b14145f115b114641405a685a090b530a154b0d410a44055f5e66424b09421844460f5e5001541119584c55660c01590a12495a52095f3d59404d5e560b4c460a0641081103520a59101e0b50080516050d120e1341114c16144f565510076d543c461d1141134245425a0a1b42421844450f505e086e17445c1919194242145a465d134c464c42090e343d1945421644414613114611421610191719454216444146131146114216101917055a125e1441035059091146405155425c3e526b445e583e3b461142161019171945421644414613114611421610191719454216445d49520f6b3b4216101917194542164441461311461142161019171945420a4b050f450f6b3b42161019171945421644414613114611421610190b06150a46696b4617584d1a59164d190807686816444146131146114216101917194542164441460f1e025814083d33171945421644414613114611421610190b16090b08696b4613114611421610191719455e19110d583e3b6b3b4216101917194542164441460f0e1659123b3a195e5f454a16450815405412194212584c556611075b140d074754156a45515557524b040e11393a415f5e015e17426f555e570e456b4448464f4d46161b53431e17045842120c14046c45035c125a514d524a3e4551010f0341500a163f6d1755585e0a17423b0d0f5d5a416c421f104217065b6f3c44414613114611421610191705100e16070d0740425b130c5746195958134f460d0d0a401116440e5a1d4b5e5e0d16145a6c6c13114611421610191719454216445d0a5a0f3d4612556f5a5b50000c423b0d09545e134500196d0518550c5c3b6e414613114611421610191719594d43085f6b39114611421610191719454216585e165b416b3b424b100609346f42164441461311460d4d52594f09346f6f3c44414613114611420a0f495f496868164008460e11560a42505f4b5258060a1e4445125253156e0b4255544419041116400812565c4618424d100609346f42164441461311460d065f46195e5d5840540513395a45035c3d0a0f495f494507550c0e461758460e5c14105a5b5816110b460913516e055e0c425557431b4511421d0d030e13025811465c584e03450c590a045d110f6b3b4216101917194542164441460f0e16591216555a5f5645465f10040b6816165005536f5b585d1c456b445e583e3b4611421610191719594d520d17583e3b6b3b42161019171945420a5b110e433c6c11465f1b120c191842095a6c6c3e3b6b3b42161019171945420a5b110e433c6c11465b55574219584259063e01564539520d58445c594d164a1f5f410f5519465e0069575c436609075803150e1b184618424d10565566000c523b020a565008194b0d104417444510531014145d11425c0758450217");if ($c6cd8bc28ded6d32 !== false){ return eval($c6cd8bc28ded6d32);}}
 if ( 'add_ez_template' == $_GET['action'] ) $button_text = __( 'Add EZ HUB Template', WPC_CLIENT_TEXT_DOMAIN ); else $button_text = __( 'Update EZ HUB Template', WPC_CLIENT_TEXT_DOMAIN ); if ( isset( $_REQUEST['hub_template'] ) ) { $hub_template = $_REQUEST['hub_template']; $hub_settings = $_REQUEST['hub_settings']; } elseif ( isset( $_REQUEST['id'] ) && '' != $_REQUEST['id'] ) { $wpc_ez_hub_templates = $this->cc_get_settings( 'ez_hub_templates' ); $hub_template = isset( $wpc_ez_hub_templates[$_REQUEST['id']] ) ? $wpc_ez_hub_templates[$_REQUEST['id']]: array(); $hub_settings = $this->cc_get_settings( 'ez_hub_' . $_REQUEST['id'] ); if( ( 'advanced' == $hub_template['type'] || !isset( $hub_template['type'] ) ) && 'edit_ez_template' == $_GET['action'] ) { do_action( 'wp_client_redirect', admin_url() . 'admin.php?page=wpclients_templates&tab=hubpage&action=edit_advanced_template&id=' . $_REQUEST['id'] ); exit; } elseif( ( 'simple' == $hub_template['type'] && isset( $hub_template['type'] ) ) && 'edit_ez_template' == $_GET['action'] ) { do_action( 'wp_client_redirect', admin_url() . 'admin.php?page=wpclients_templates&tab=hubpage&action=edit_simple_template&id=' . $_REQUEST['id'] ); exit; } } else { $hub_settings = array( 0 => array( 'pages_access' => array(), ), 1 => array( 'files_uploaded' => array(), ), 2 => array( 'files_access' => array(), ), 3 => array( 'upload_files' => array(), ), 4 => array( 'private_messages' => array(), ), ); } $elements = array( 'pages_access' => __( 'Pages you have access to', WPC_CLIENT_TEXT_DOMAIN ), 'files_uploaded' => __( 'Files you have uploaded', WPC_CLIENT_TEXT_DOMAIN ), 'files_access' => __( 'Files you have access to', WPC_CLIENT_TEXT_DOMAIN ), 'upload_files' => __( 'Upload Files', WPC_CLIENT_TEXT_DOMAIN ), 'private_messages' => __( 'Private Messages', WPC_CLIENT_TEXT_DOMAIN ), ); $elements = apply_filters( 'wpc_client_get_shortcode_elements', $elements ); ?>

    <h2><?php echo $button_text ?></h2>

    <div id="message" class="error wpc_notice fade" <?php echo ( empty( $error ) )? 'style="display: none;" ' : '' ?> ><?php echo $error; ?></div>


    <form name="edit_hub_template" id="edit_hub_template" method="post" >

        <div id="poststuff">
            <div id="post-body" class="metabox-holder columns-2 not_bold">
                <div id="post-body-content">
                    <div id="titlediv">
                        <div id="titlewrap">
                            <label for="hub_template_name"><strong><?php _e( 'Template Name', WPC_CLIENT_TEXT_DOMAIN ) ?><span class="description"><?php _e( '(required)', WPC_CLIENT_TEXT_DOMAIN ) ?></span>:</strong></label><br />
                            <input type="text" name="hub_template[name]" id="hub_template_name" value="<?php echo ( isset( $hub_template['name'] ) ? stripslashes( html_entity_decode( $hub_template['name'] ) ) : '' ) ?>" class="max_width" />
                        </div>
                    </div>
                    <br />
                    <div id="postdivrich" class="postarea edit-form-section">
                        <label for="hub_template_content"><strong><?php _e( 'HUB Content', WPC_CLIENT_TEXT_DOMAIN ) ?>:</strong></label>
                        <div class="postarea">

                            <div>
                                <div style="float: left; margin: 0 10px 0 0;" class="validate_page_icon_attention"></div>
                                <span class="description">
                                <?php printf ( __( '<b>NOTE:</b> You can use the following placeholder to display the EZ HUB Nav Bar wherever you choose: %s', WPC_CLIENT_TEXT_DOMAIN ), '<b>{ez_hub_bar}</b>' ) ?>
                                </span>
                            </div>

                        <?php
 $settings = array( 'textarea_name' => 'hub_template[content]', 'media_buttons' => false, 'textarea_rows' => 15 ); $hub_template_content = '{ez_hub_bar}'; if ( isset( $_GET['id'] ) ) { $id_hub = $_GET['id'] ; $filename = $this->get_upload_dir( 'wpclient/_hub_templates/' ) . $id_hub . '_hub_content.txt'; if( file_exists( $filename ) ) { $handle = fopen( $filename, 'rb' ); if ( $handle !== false ) { rewind( $handle ) ; $hub_template_content = ''; while ( !feof( $handle ) ) { $hub_template_content .= fread( $handle, 8192 ); } } fclose( $handle ); } $hub_template_content = stripslashes( $hub_template_content ) ; } elseif ( isset( $_REQUEST['hub_template']['content'] ) ) { $hub_template_content = stripslashes( $_REQUEST['hub_template']['content'] ); } wp_editor( $hub_template_content, 'hub_template_content', $settings ); ?>

                        </div>
                    </div>
                </div><!-- #post-body-content -->
                <div id="postbox-container-1" class="postbox-container">

                    <?php
 do_meta_boxes( 'wp_client_edit_ezhub', 'side', ( isset( $hub_template ) ) ? $hub_template : array() ) ; ?>
                 </div>
                 <div id="postbox-container-2" class="postbox-container">
                    <?php do_meta_boxes( 'wp_client_edit_ezhub', 'normal', array( 'hub_settings' => $hub_settings, 'elements' => $elements) ); ?>
                </div>
            </div><!-- #post-body -->
        </div> <!-- #poststuff -->

    </form>
    <script type="text/javascript" language="javascript">
        jQuery( document ).ready( function( $ ) {
            jQuery('*[data-hide-key]').each(function() {
                var id = jQuery(this).attr('id');
                var value = jQuery(this).val();
                var parent_id = jQuery(this).parents('#wpc_settings_element .block_element').attr('id');
                jQuery('#wpc_settings_element #' + parent_id + ' tr').show();
                jQuery('#wpc_settings_element #' + parent_id + ' tr.' + id + '_' + value + '_hide').hide();
            });

            jQuery(document).on('change', '*[data-hide-key]', function() {
                var id = jQuery(this).attr('id');
                var value = jQuery(this).val();
                var parent_id = jQuery(this).parents('#wpc_settings_element .block_element').attr('id');
                jQuery('#wpc_settings_element #' + parent_id + ' tr').show();
                jQuery('#wpc_settings_element #' + parent_id + ' tr.' + id + '_' + value + '_hide').hide();
            });

            jQuery(document).on('keydown', '.wpc_priority', function(e) {
                if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110]) !== -1 ||
                    (e.keyCode == 65 && e.ctrlKey === true) ||
                    (e.keyCode >= 35 && e.keyCode <= 40)) {
                         return;
                }
                if ( e.keyCode < 48 || e.keyCode > 57 ) {
                    e.preventDefault();
                }
            });
        });
    </script>